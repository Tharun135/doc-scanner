<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Unicode btoa Fix Test</title>
</head>
<body>
    <h1>Test Unicode Characters in AI Suggestion</h1>
    
    <div id="results"></div>
    
    <script>
        // Test the exact same scenario that was causing the error
        function testUnicodeHandling() {
            const resultsDiv = document.getElementById('results');
            
            // Test strings with various Unicode characters that would break btoa()
            const testCases = [
                "Regular text without special characters",
                "Text with \u201csmart quotes\u201d that break btoa",
                "Text with em\u2014dash that breaks btoa", 
                "Text with symbols: \u00a9 \u00ae \u2122 that break btoa",
                "Text with accented characters: caf\u00e9, na\u00efve, r\u00e9sum\u00e9",
                "Mixed: \u201cSmart quotes\u201d, em\u2014dash, and symbols \u00a9 \u00ae"
            ];
            
            resultsDiv.innerHTML = '<h2>Testing Unicode Character Handling</h2>';
            
            testCases.forEach((testText, index) => {
                const testDiv = document.createElement('div');
                testDiv.style.margin = '10px 0';
                testDiv.style.padding = '10px';
                testDiv.style.border = '1px solid #ccc';
                
                try {
                    // OLD WAY (would fail with Unicode)
                    let btoaResult = 'WOULD FAIL';
                    try {
                        btoaResult = btoa(testText);
                    } catch (e) {
                        btoaResult = `❌ ERROR: ${e.message}`;
                    }
                    
                    // NEW WAY (safe with Unicode)
                    const safeResult = encodeURIComponent(testText).replace(/[^a-zA-Z0-9]/g, '');
                    
                    testDiv.innerHTML = `
                        <strong>Test ${index + 1}:</strong> ${testText}<br>
                        <strong>btoa() result:</strong> ${btoaResult}<br>
                        <strong>Safe encoding:</strong> ${safeResult}<br>
                        <strong>Status:</strong> ${btoaResult.includes('ERROR') ? '❌ btoa would fail' : '✅ btoa would work'} | ✅ Safe encoding works
                    `;
                    
                } catch (error) {
                    testDiv.innerHTML = `
                        <strong>Test ${index + 1}:</strong> ${testText}<br>
                        <strong>Unexpected error:</strong> ${error.message}
                    `;
                }
                
                resultsDiv.appendChild(testDiv);
            });
            
            // Add summary
            const summaryDiv = document.createElement('div');
            summaryDiv.style.marginTop = '20px';
            summaryDiv.style.padding = '15px';
            summaryDiv.style.backgroundColor = '#e8f5e8';
            summaryDiv.style.border = '2px solid #4caf50';
            summaryDiv.innerHTML = `
                <h3>✅ Fix Applied Successfully!</h3>
                <p>The original code used <code>btoa(decodedFeedback)</code> which would fail with Unicode characters.</p>
                <p>The fixed code uses <code>encodeURIComponent(decodedFeedback)</code> which safely handles all Unicode characters.</p>
                <p><strong>Result:</strong> AI suggestions should now work with all types of text content!</p>
            `;
            resultsDiv.appendChild(summaryDiv);
        }
        
        // Run the test when page loads
        window.addEventListener('load', testUnicodeHandling);
    </script>
</body>
</html>
